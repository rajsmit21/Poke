<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        connect-src 'self' https://pokeapi.co;
        img-src 'self' https://raw.githubusercontent.com data:;
        style-src 'self' 'unsafe-inline';
        script-src 'self' 'unsafe-inline';
    ">
    <title>Pokémon Info</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            transition: background-color 0.5s ease-in-out; /* Animation 1: Smooth background color transition */
            position: relative;
            overflow-x: hidden;
        }
        .container {
            max-width: 900px;
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            text-align: center;
            width: 100%;
            animation: slideInFromTop 0.5s ease-out; /* Animation 2: Container slide-in */
        }
        h1 {
            color: #333;
            margin-bottom: 15px;
            font-size: 2.2em;
            text-transform: uppercase;
            animation: fadeIn 0.8s ease-in; /* Animation 3: Title fade-in */
        }
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }
        #search-bar {
            width: 100%;
            max-width: 400px;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #333;
            border-radius: 8px;
            outline: none;
            transition: border-color 0.3s, box-shadow 0.3s, transform 0.3s; /* Animation 4: Search bar transitions */
            animation: pulseGlow 2s infinite; /* Animation 5: Search bar pulse */
        }
        #search-bar:focus {
            border-color: #007bff;
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.5);
            transform: scale(1.02); /* Animation 6: Search bar scale on focus */
        }
        #suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-width: 400px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            display: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            animation: slideInFromBottom 0.4s ease-out; /* Animation 7: Suggestions slide-in */
        }
        .suggestion-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s, transform 0.2s; /* Animation 8: Suggestion transitions */
        }
        .suggestion-item:hover {
            background-color: #e6f3ff;
            transform: translateX(10px); /* Animation 9: Suggestion slide on hover */
        }
        .pokemon-info {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        .pokemon-image {
            flex: 1;
            min-width: 200px;
        }
        canvas {
            border: 2px solid #333;
            border-radius: 12px;
            background: #f0f0f0;
            transition: transform 0.3s; /* Animation 10: Canvas transition */
        }
        .details {
            flex: 2;
            min-width: 300px;
        }
        .details-table {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        .table-box {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, background-color 0.3s, box-shadow 0.3s; /* Animation 11: Table box transitions */
            animation: bounceIn 0.6s ease-out; /* Animation 12: Table box bounce-in */
        }
        .table-box:hover {
            transform: scale(1.05); /* Animation 13: Table box scale on hover */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .table-box h3 {
            margin: 0 0 10px;
            color: #333;
            font-size: 1.2em;
            text-transform: uppercase;
            animation: slideInFromLeft 0.5s ease-out; /* Animation 14: Box header slide-in */
        }
        .table-box p, .table-box ul {
            margin: 0;
            color: #555;
            animation: fadeInUp 0.5s ease-out; /* Animation 15: Box content fade-in */
        }
        .evolution-link {
            color: #007bff;
            cursor: pointer;
            text-decoration: underline;
            margin: 0 5px;
            transition: color 0.2s, transform 0.2s; /* Animation 16: Evolution link transitions */
        }
        .evolution-link:hover {
            color: #0056b3;
            transform: scale(1.1); /* Animation 17: Evolution link scale on hover */
        }
        .moves-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 8px;
            list-style: none;
            animation: fadeInUp 0.5s ease-out; /* Animation 18: Moves list fade-in */
        }
        .moves-list li {
            padding: 5px 0;
            font-size: 0.9em;
            transition: transform 0.2s; /* Animation 19: Move item transition */
        }
        .moves-list li:hover {
            transform: translateX(5px); /* Animation 20: Move item slide on hover */
        }
        .stats-box {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            animation: bounceIn 0.6s ease-out; /* Animation 21: Stats box bounce-in */
        }
        .stat-bar-container {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        .stat-label {
            width: 120px;
            font-weight: bold;
            color: #333;
        }
        .stat-bar {
            flex-grow: 1;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }
        .stat-bar-fill {
            height: 100%;
            background: #007bff;
            transition: width 1s ease-out; /* Animation 22: Stat bar fill animation */
        }
        .stat-value {
            margin-left: 10px;
            color: #555;
        }
        .error {
            color: #d32f2f;
            font-weight: bold;
            margin-top: 20px;
            animation: shake 0.5s ease-in-out; /* Animation 23: Error shake */
        }
        /* Type-based background colors */
        .type-normal { background-color: #A8A878; }
        .type-fire { background-color: #F08030; }
        .type-water { background-color: #6890F0; }
        .type-grass { background-color: #78C850; }
        .type-electric { background-color: #F8D030; }
        .type-ice { background-color: #98D8D8; }
        .type-fighting { background-color: #C03028; }
        .type-poison { background-color: #A040A0; }
        .type-ground { background-color: #E0C068; }
        .type-flying { background-color: #A890F0; }
        .type-psychic { background-color: #F85888; }
        .type-bug { background-color: #A8B820; }
        .type-rock { background-color: #B8A038; }
        .type-ghost { background-color: #705898; }
        .type-dragon { background-color: #7038F8; }
        .type-dark { background-color: #705848; }
        .type-steel { background-color: #B8B8D0; }
        .type-fairy { background-color: #F0B6BC; }
        /* Animation keyframes */
        @keyframes slideInFromTop {
            0% { transform: translateY(-50px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        @keyframes pulseGlow {
            0% { box-shadow: 0 0 5px rgba(0, 123, 255, 0.3); }
            50% { box-shadow: 0 0 15px rgba(0, 123, 255, 0.6); }
            100% { box-shadow: 0 0 5px rgba(0, 123, 255, 0.3); }
        }
        @keyframes slideInFromBottom {
            0% { transform: translateY(50px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.2); opacity: 0.5; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes slideInFromLeft {
            0% { transform: translateX(-30px); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeInUp {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        @keyframes evolveGlow {
            0% { box-shadow: 0 0 10px 5px rgba(255, 255, 255, 0.8); }
            50% { box-shadow: 0 0 20px 10px rgba(255, 255, 255, 1); }
            100% { box-shadow: 0 0 10px 5px rgba(255, 255, 255, 0.8); }
        }
        @keyframes evolveSparkle {
            0% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(1.5); }
        }
        .evolving {
            animation: evolveGlow 1.5s ease-in-out 2; /* Animation 24: Evolution glow */
        }
        .sparkle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, #fff, transparent);
            border-radius: 50%;
            pointer-events: none;
            animation: evolveSparkle 0.5s ease-out; /* Animation 25: Sparkle effect */
        }
        /* Additional animations */
        @keyframes rotateIn {
            0% { transform: rotate(-10deg); opacity: 0; }
            100% { transform: rotate(0); opacity: 1; }
        }
        @keyframes zoomIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes flipIn {
            0% { transform: rotateY(90deg); opacity: 0; }
            100% { transform: rotateY(0); opacity: 1; }
        }
        @keyframes swing {
            20% { transform: rotate(15deg); }
            40% { transform: rotate(-10deg); }
            60% { transform: rotate(5deg); }
            80% { transform: rotate(-5deg); }
            100% { transform: rotate(0); }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .pokemon-image canvas:hover {
            animation: pulse 1s infinite; /* Animation 26: Canvas pulse on hover */
        }
        /* Responsive adjustments */
        @media (max-width: 600px) {
            .pokemon-info {
                flex-direction: column;
                align-items: center;
            }
            .pokemon-image, .details {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Pokédex</h1>
        <div class="search-container">
            <input type="text" id="search-bar" placeholder="Search Pokémon (e.g., Mew)" autocomplete="off">
            <div id="suggestions"></div>
        </div>
        <div id="pokemon-info" class="pokemon-info">
            <div class="pokemon-image">
                <canvas id="pokemon-canvas" width="200" height="200"></canvas>
            </div>
            <div class="details">
                <div class="details-table">
                    <div class="table-box" id="name-box">
                        <h3>Name</h3>
                        <p id="name"></p>
                    </div>
                    <div class="table-box" id="id-box">
                        <h3>ID</h3>
                        <p id="id"></p>
                    </div>
                    <div class="table-box" id="types-box">
                        <h3>Types</h3>
                        <p id="types"></p>
                    </div>
                    <div class="table-box" id="height-box">
                        <h3>Height</h3>
                        <p id="height"></p>
                    </div>
                    <div class="table-box" id="weight-box">
                        <h3>Weight</h3>
                        <p id="weight"></p>
                    </div>
                    <div class="table-box" id="abilities-box">
                        <h3>Abilities</h3>
                        <p id="abilities"></p>
                    </div>
                    <div class="table-box" id="weaknesses-box">
                        <h3>Weaknesses</h3>
                        <p id="weaknesses"></p>
                    </div>
                    <div class="table-box" id="evolutions-box">
                        <h3>Evolutions</h3>
                        <p id="evolutions"></p>
                    </div>
                    <div class="table-box stats-box" id="stats-box">
                        <h3>Base Stats</h3>
                        <div id="stats"></div>
                    </div>
                    <div class="table-box" id="moves-box">
                        <h3>Moves</h3>
                        <ul id="moves" class="moves-list"></ul>
                    </div>
                </div>
            </div>
        </div>
        <p id="error" class="error" style="display: none;"></p>
    </div>

    <script>
        const typeChart = {
            normal: ["fighting"],
            fire: ["water", "rock", "electric"],
            water: ["grass", "electric"],
            grass: ["fire", "poison", "flying", "bug", "ice"],
            electric: ["ground"],
            ice: ["fire", "fighting", "rock", "steel"],
            fighting: ["flying", "psychic", "fairy"],
            poison: ["ground", "psychic"],
            ground: ["water", "grass", "ice"],
            flying: ["electric", "ice", "rock"],
            psychic: ["bug", "ghost", "dark"],
            bug: ["fire", "flying", "rock"],
            rock: ["water", "grass", "fighting", "ground", "steel"],
            ghost: ["ghost", "dark"],
            dragon: ["ice", "dragon", "fairy"],
            dark: ["fighting", "bug", "fairy"],
            steel: ["fire", "fighting", "ground"],
            fairy: ["poison", "steel"]
        };

        let allPokemonNames = [];

        // Fetch all Pokémon names for suggestions
        async function fetchAllPokemonNames() {
            try {
                const response = await fetch('https://pokeapi.co/api/v2/pokemon?limit=10000');
                if (!response.ok) throw new Error('Failed to fetch Pokémon list');
                const data = await response.json();
                allPokemonNames = data.results.map(p => p.name);
            } catch (error) {
                console.error('Error fetching Pokémon names:', error);
                document.getElementById('error').textContent = 'Failed to load Pokémon list';
                document.getElementById('error').style.display = 'block';
            }
        }

        // Fetch Pokémon info
        async function fetchPokemonInfo(pokemonName) {
            try {
                const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${pokemonName.toLowerCase()}`);
                if (!response.ok) throw new Error(`Pokémon '${pokemonName}' not found`);
                const data = await response.json();
                const types = data.types.map(t => t.type.name);

                // Fetch evolution chain
                const speciesResponse = await fetch(data.species.url);
                if (!speciesResponse.ok) throw new Error('Failed to fetch species data');
                const speciesData = await speciesResponse.json();
                const evolutionResponse = await fetch(speciesData.evolution_chain.url);
                if (!evolutionResponse.ok) throw new Error('Failed to fetch evolution chain');
                const evolutionData = await evolutionResponse.json();
                const evolutions = getEvolutionChain(evolutionData.chain);

                // Fetch move details (power and accuracy)
                const moves = await Promise.all(
                    data.moves.slice(0, 10).map(async m => {
                        const moveResponse = await fetch(m.move.url);
                        if (!moveResponse.ok) return { name: m.move.name, power: 'N/A', accuracy: 'N/A' };
                        const moveData = await moveResponse.json();
                        return {
                            name: m.move.name,
                            power: moveData.power ?? 'N/A',
                            accuracy: moveData.accuracy ?? 'N/A'
                        };
                    })
                );

                // Fetch base stats
                const stats = data.stats.map(stat => ({
                    name: stat.stat.name.replace('special-', 'Sp. '),
                    value: stat.base_stat
                }));

                return {
                    name: data.name.charAt(0).toUpperCase() + data.name.slice(1),
                    id: data.id,
                    types: types,
                    height: data.height,
                    weight: data.weight,
                    abilities: data.abilities.map(a => a.ability.name),
                    image: data.sprites.front_default,
                    weaknesses: getWeaknesses(types),
                    evolutions: evolutions,
                    moves: moves,
                    stats: stats
                };
            } catch (error) {
                document.getElementById('error').textContent = error.message;
                document.getElementById('error').style.display = 'block';
                return null;
            }
        }

        function getWeaknesses(types) {
            let weaknesses = [];
            types.forEach(type => {
                if (typeChart[type]) {
                    weaknesses = [...weaknesses, ...typeChart[type]];
                }
            });
            return [...new Set(weaknesses)];
        }

        function getEvolutionChain(chain) {
            const evolutions = [];
            let current = chain;
            while (current) {
                evolutions.push(current.species.name.charAt(0).toUpperCase() + current.species.name.slice(1));
                current = current.evolves_to[0]; // Simplified to first evolution
            }
            return evolutions;
        }

        function drawPokemonSprite(canvas, imageUrl, isEvolving = false) {
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw gradient background
            const gradient = ctx.createRadialGradient(100, 100, 20, 100, 100, 100);
            gradient.addColorStop(0, '#ffffff');
            gradient.addColorStop(1, '#f0f0f0');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw Pokémon sprite
            const img = new Image();
            img.crossOrigin = "Anonymous";
            img.onload = () => {
                ctx.drawImage(img, 50, 50, 100, 100);
                if (isEvolving) {
                    canvas.classList.add('evolving');
                    // Add sparkle particles
                    for (let i = 0; i < 10; i++) {
                        const sparkle = document.createElement('div');
                        sparkle.className = 'sparkle';
                        sparkle.style.left = `${canvas.offsetLeft + 50 + Math.random() * 100}px`;
                        sparkle.style.top = `${canvas.offsetTop + 50 + Math.random() * 100}px`;
                        document.body.appendChild(sparkle);
                        setTimeout(() => sparkle.remove(), 500); /* Animation 27: Sparkle particle */
                    }
                    setTimeout(() => {
                        canvas.classList.remove('evolving');
                    }, 1500); // Match glow animation duration
                }
            };
            img.onerror = () => {
                console.error('Failed to load sprite:', imageUrl);
                document.getElementById('error').textContent = 'Failed to load Pokémon sprite';
                document.getElementById('error').style.display = 'block';
            };
            img.src = imageUrl;
        }

        async function displayPokemonInfo(pokemonName, isEvolving = false) {
            const pokemon = await fetchPokemonInfo(pokemonName);
            if (!pokemon) return;

            // Update DOM
            document.getElementById('name').textContent = pokemon.name;
            document.getElementById('id').textContent = pokemon.id;
            document.getElementById('types').textContent = pokemon.types.join(', ');
            document.getElementById('height').textContent = `${pokemon.height / 10} m`;
            document.getElementById('weight').textContent = `${pokemon.weight / 10} kg`;
            document.getElementById('abilities').textContent = pokemon.abilities.join(', ');
            document.getElementById('weaknesses').textContent = pokemon.weaknesses.join(', ');

            // Update evolutions with clickable links
            const evolutionsEl = document.getElementById('evolutions');
            evolutionsEl.innerHTML = '';
            pokemon.evolutions.forEach((evo, index) => {
                const span = document.createElement('span');
                span.textContent = evo;
                if (evo.toLowerCase() !== pokemonName.toLowerCase()) {
                    span.className = 'evolution-link';
                    span.addEventListener('click', () => {
                        searchBar.value = evo;
                        displayPokemonInfo(evo.toLowerCase(), true); // Trigger evolving animation
                    });
                }
                evolutionsEl.appendChild(span);
                if (index < pokemon.evolutions.length - 1) {
                    evolutionsEl.appendChild(document.createTextNode(' → '));
                }
            });

            // Update moves
            const movesList = document.getElementById('moves');
            movesList.innerHTML = '';
            pokemon.moves.forEach((move, index) => {
                const li = document.createElement('li');
                li.textContent = `${move.name} (Power: ${move.power}, Accuracy: ${move.accuracy}%)`;
                li.style.animationDelay = `${index * 0.1}s`; /* Animation 28-37: Staggered move item fade-in */
                movesList.appendChild(li);
            });

            // Update stats with loading bars
            const statsEl = document.getElementById('stats');
            statsEl.innerHTML = '';
            pokemon.stats.forEach((stat, index) => {
                const container = document.createElement('div');
                container.className = 'stat-bar-container';
                container.style.animation = `zoomIn 0.5s ease-out ${index * 0.1}s`; /* Animation 38-43: Staggered stat bar zoom-in */
                container.style.animationFillMode = 'both';
                const label = document.createElement('span');
                label.className = 'stat-label';
                label.textContent = stat.name;
                const bar = document.createElement('div');
                bar.className = 'stat-bar';
                const fill = document.createElement('div');
                fill.className = 'stat-bar-fill';
                fill.style.width = '0%'; // Start at 0
                setTimeout(() => {
                    fill.style.width = `${Math.min((stat.value / 255) * 100, 100)}%`; /* Animation 44-49: Stat bar fill */
                }, 100);
                bar.appendChild(fill);
                const value = document.createElement('span');
                value.className = 'stat-value';
                value.textContent = stat.value;
                container.appendChild(label);
                container.appendChild(bar);
                container.appendChild(value);
                statsEl.appendChild(container);
            });

            // Draw sprite on canvas
            const canvas = document.getElementById('pokemon-canvas');
            drawPokemonSprite(canvas, pokemon.image, isEvolving);

            // Set dynamic background and table box colors
            const primaryType = pokemon.types[0];
            document.body.className = `type-${primaryType}`;
            document.querySelectorAll('.table-box').forEach((box, index) => {
                box.style.backgroundColor = getComputedStyle(document.body).backgroundColor;
                box.style.opacity = '0.9';
                box.style.animation = `flipIn 0.5s ease-out ${index * 0.1}s`; /* Animation 50: Staggered box flip-in */
                box.style.animationFillMode = 'both';
            });

            // Update URL
            history.pushState({}, '', `?poke=${pokemonName.toLowerCase()}`);
        }

        // Handle search bar and suggestions
        const searchBar = document.getElementById('search-bar');
        const suggestionsDiv = document.getElementById('suggestions');

        searchBar.addEventListener('input', () => {
            const query = searchBar.value.toLowerCase();
            suggestionsDiv.innerHTML = '';
            if (query.length < 1) {
                suggestionsDiv.style.display = 'none';
                return;
            }

            const matches = allPokemonNames.filter(name => name.toLowerCase().includes(query)).slice(0, 10);
            matches.forEach((name, index) => {
                const div = document.createElement('div');
                div.className = 'suggestion-item';
                div.textContent = name.charAt(0).toUpperCase() + name.slice(1);
                div.style.animation = `rotateIn 0.4s ease-out ${index * 0.05}s`; /* Animation 51-60: Staggered suggestion rotate-in */
                div.style.animationFillMode = 'both';
                div.addEventListener('click', () => {
                    searchBar.value = div.textContent;
                    suggestionsDiv.style.display = 'none';
                    displayPokemonInfo(name);
                });
                suggestionsDiv.appendChild(div);
            });
            suggestionsDiv.style.display = matches.length > 0 ? 'block' : 'none';
        });

        // Hide suggestions when clicking outside
        document.addEventListener('click', (e) => {
            if (!searchBar.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                suggestionsDiv.style.display = 'none';
            }
        });

        // Handle Enter key to search
        searchBar.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && searchBar.value) {
                suggestionsDiv.style.display = 'none';
                displayPokemonInfo(searchBar.value);
            }
        });

        // Initialize
        async function init() {
            await fetchAllPokemonNames();
            const urlParams = new URLSearchParams(window.location.search);
            const pokemonName = urlParams.get('poke') || 'pikachu';
            searchBar.value = pokemonName.charAt(0).toUpperCase() + pokemonName.slice(1);
            displayPokemonInfo(pokemonName);
        }

        init();
    </script>
</body>
  </html>
