<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        connect-src 'self' https://pokeapi.co;
        img-src 'self' https://raw.githubusercontent.com data:;
        style-src 'self' 'unsafe-inline';
        script-src 'self' 'unsafe-inline';
    ">
    <title>Pokémon Info</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            transition: background-color 0.5s;
        }
        .container {
            max-width: 900px;
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            text-align: center;
            width: 100%;
        }
        h1 {
            color: #333;
            margin-bottom: 15px;
            font-size: 2.2em;
            text-transform: uppercase;
        }
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }
        #search-bar {
            width: 100%;
            max-width: 400px;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #333;
            border-radius: 8px;
            outline: none;
            transition: border-color 0.3s;
        }
        #search-bar:focus {
            border-color: #007bff;
        }
        #suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-width: 400px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            display: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .suggestion-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }
        .suggestion-item:hover {
            background-color: #e6f3ff;
        }
        .pokemon-info {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        .pokemon-image {
            flex: 1;
            min-width: 200px;
        }
        canvas {
            border: 2px solid #333;
            border-radius: 12px;
            background: #f0f0f0;
            transition: transform 0.3s;
        }
        .details {
            flex: 2;
            min-width: 300px;
        }
        .details-table {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        .table-box {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, background-color 0.3s;
        }
        .table-box:hover {
            transform: translateY(-5px);
        }
        .table-box h3 {
            margin: 0 0 10px;
            color: #333;
            font-size: 1.2em;
            text-transform: uppercase;
        }
        .table-box p, .table-box ul {
            margin: 0;
            color: #555;
        }
        .evolution-link {
            color: #007bff;
            cursor: pointer;
            text-decoration: underline;
            margin: 0 5px;
        }
        .evolution-link:hover {
            color: #0056b3;
        }
        .moves-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 8px;
            list-style: none;
        }
        .moves-list li {
            padding: 5px 0;
            font-size: 0.9em;
        }
        .error {
            color: #d32f2f;
            font-weight: bold;
            margin-top: 20px;
        }
        /* Type-based background colors */
        .type-normal { background-color: #A8A878; }
        .type-fire { background-color: #F08030; }
        .type-water { background-color: #6890F0; }
        .type-grass { background-color: #78C850; }
        .type-electric { background-color: #F8D030; }
        .type-ice { background-color: #98D8D8; }
        .type-fighting { background-color: #C03028; }
        .type-poison { background-color: #A040A0; }
        .type-ground { background-color: #E0C068; }
        .type-flying { background-color: #A890F0; }
        .type-psychic { background-color: #F85888; }
        .type-bug { background-color: #A8B820; }
        .type-rock { background-color: #B8A038; }
        .type-ghost { background-color: #705898; }
        .type-dragon { background-color: #7038F8; }
        .type-dark { background-color: #705848; }
        .type-steel { background-color: #B8B8D0; }
        .type-fairy { background-color: #F0B6BC; }
        /* Animation for canvas */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .pokemon-image canvas:hover {
            animation: pulse 1s infinite;
        }
        /* Evolving animation */
        @keyframes evolveGlow {
            0% { box-shadow: 0 0 10px 5px rgba(255, 255, 255, 0.8); }
            50% { box-shadow: 0 0 20px 10px rgba(255, 255, 255, 1); }
            100% { box-shadow: 0 0 10px 5px rgba(255, 255, 255, 0.8); }
        }
        .evolving {
            animation: evolveGlow 1.5s ease-in-out 2;
        }
        /* Responsive adjustments */
        @media (max-width: 600px) {
            .pokemon-info {
                flex-direction: column;
                align-items: center;
            }
            .pokemon-image, .details {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Pokémon Information</h1>
        <div class="search-container">
            <input type="text" id="search-bar" placeholder="Search Pokémon (e.g., Mew)" autocomplete="off">
            <div id="suggestions"></div>
        </div>
        <div id="pokemon-info" class="pokemon-info">
            <div class="pokemon-image">
                <canvas id="pokemon-canvas" width="200" height="200"></canvas>
            </div>
            <div class="details">
                <div class="details-table">
                    <div class="table-box" id="name-box">
                        <h3>Name</h3>
                        <p id="name"></p>
                    </div>
                    <div class="table-box" id="id-box">
                        <h3>ID</h3>
                        <p id="id"></p>
                    </div>
                    <div class="table-box" id="types-box">
                        <h3>Types</h3>
                        <p id="types"></p>
                    </div>
                    <div class="table-box" id="height-box">
                        <h3>Height</h3>
                        <p id="height"></p>
                    </div>
                    <div class="table-box" id="weight-box">
                        <h3>Weight</h3>
                        <p id="weight"></p>
                    </div>
                    <div class="table-box" id="abilities-box">
                        <h3>Abilities</h3>
                        <p id="abilities"></p>
                    </div>
                    <div class="table-box" id="weaknesses-box">
                        <h3>Weaknesses</h3>
                        <p id="weaknesses"></p>
                    </div>
                    <div class="table-box" id="evolutions-box">
                        <h3>Evolutions</h3>
                        <p id="evolutions"></p>
                    </div>
                    <div class="table-box" id="moves-box">
                        <h3>Moves</h3>
                        <ul id="moves" class="moves-list"></ul>
                    </div>
                </div>
            </div>
        </div>
        <p id="error" class="error" style="display: none;"></p>
    </div>

    <script>
        const typeChart = {
            normal: ["fighting"],
            fire: ["water", "rock", "electric"],
            water: ["grass", "electric"],
            grass: ["fire", "poison", "flying", "bug", "ice"],
            electric: ["ground"],
            ice: ["fire", "fighting", "rock", "steel"],
            fighting: ["flying", "psychic", "fairy"],
            poison: ["ground", "psychic"],
            ground: ["water", "grass", "ice"],
            flying: ["electric", "ice", "rock"],
            psychic: ["bug", "ghost", "dark"],
            bug: ["fire", "flying", "rock"],
            rock: ["water", "grass", "fighting", "ground", "steel"],
            ghost: ["ghost", "dark"],
            dragon: ["ice", "dragon", "fairy"],
            dark: ["fighting", "bug", "fairy"],
            steel: ["fire", "fighting", "ground"],
            fairy: ["poison", "steel"]
        };

        let allPokemonNames = [];

        // Fetch all Pokémon names for suggestions
        async function fetchAllPokemonNames() {
            try {
                const response = await fetch('https://pokeapi.co/api/v2/pokemon?limit=10000');
                if (!response.ok) throw new Error('Failed to fetch Pokémon list');
                const data = await response.json();
                allPokemonNames = data.results.map(p => p.name);
            } catch (error) {
                console.error('Error fetching Pokémon names:', error);
                document.getElementById('error').textContent = 'Failed to load Pokémon list';
                document.getElementById('error').style.display = 'block';
            }
        }

        // Fetch Pokémon info
        async function fetchPokemonInfo(pokemonName) {
            try {
                const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${pokemonName.toLowerCase()}`);
                if (!response.ok) throw new Error(`Pokémon '${pokemonName}' not found`);
                const data = await response.json();
                const types = data.types.map(t => t.type.name);

                // Fetch evolution chain
                const speciesResponse = await fetch(data.species.url);
                if (!speciesResponse.ok) throw new Error('Failed to fetch species data');
                const speciesData = await speciesResponse.json();
                const evolutionResponse = await fetch(speciesData.evolution_chain.url);
                if (!evolutionResponse.ok) throw new Error('Failed to fetch evolution chain');
                const evolutionData = await evolutionResponse.json();
                const evolutions = getEvolutionChain(evolutionData.chain);

                // Fetch move details (power and accuracy)
                const moves = await Promise.all(
                    data.moves.slice(0, 10).map(async m => {
                        const moveResponse = await fetch(m.move.url);
                        if (!moveResponse.ok) return { name: m.move.name, power: 'N/A', accuracy: 'N/A' };
                        const moveData = await moveResponse.json();
                        return {
                            name: m.move.name,
                            power: moveData.power ?? 'N/A',
                            accuracy: moveData.accuracy ?? 'N/A'
                        };
                    })
                );

                return {
                    name: data.name.charAt(0).toUpperCase() + data.name.slice(1),
                    id: data.id,
                    types: types,
                    height: data.height,
                    weight: data.weight,
                    abilities: data.abilities.map(a => a.ability.name),
                    image: data.sprites.front_default,
                    weaknesses: getWeaknesses(types),
                    evolutions: evolutions,
                    moves: moves
                };
            } catch (error) {
                document.getElementById('error').textContent = error.message;
                document.getElementById('error').style.display = 'block';
                return null;
            }
        }

        function getWeaknesses(types) {
            let weaknesses = [];
            types.forEach(type => {
                if (typeChart[type]) {
                    weaknesses = [...weaknesses, ...typeChart[type]];
                }
            });
            return [...new Set(weaknesses)];
        }

        function getEvolutionChain(chain) {
            const evolutions = [];
            let current = chain;
            while (current) {
                evolutions.push(current.species.name.charAt(0).toUpperCase() + current.species.name.slice(1));
                current = current.evolves_to[0]; // Simplified to first evolution
            }
            return evolutions;
        }

        function drawPokemonSprite(canvas, imageUrl, isEvolving = false) {
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw gradient background
            const gradient = ctx.createRadialGradient(100, 100, 20, 100, 100, 100);
            gradient.addColorStop(0, '#ffffff');
            gradient.addColorStop(1, '#f0f0f0');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw Pokémon sprite
            const img = new Image();
            img.crossOrigin = "Anonymous";
            img.onload = () => {
                ctx.drawImage(img, 50, 50, 100, 100);
                if (isEvolving) {
                    canvas.classList.add('evolving');
                    setTimeout(() => {
                        canvas.classList.remove('evolving');
                    }, 1500); // Match animation duration
                }
            };
            img.onerror = () => {
                console.error('Failed to load sprite:', imageUrl);
                document.getElementById('error').textContent = 'Failed to load Pokémon sprite';
                document.getElementById('error').style.display = 'block';
            };
            img.src = imageUrl;
        }

        async function displayPokemonInfo(pokemonName, isEvolving = false) {
            const pokemon = await fetchPokemonInfo(pokemonName);
            if (!pokemon) return;

            // Update DOM
            document.getElementById('name').textContent = pokemon.name;
            document.getElementById('id').textContent = pokemon.id;
            document.getElementById('types').textContent = pokemon.types.join(', ');
            document.getElementById('height').textContent = `${pokemon.height / 10} m`;
            document.getElementById('weight').textContent = `${pokemon.weight / 10} kg`;
            document.getElementById('abilities').textContent = pokemon.abilities.join(', ');
            document.getElementById('weaknesses').textContent = pokemon.weaknesses.join(', ');

            // Update evolutions with clickable links
            const evolutionsEl = document.getElementById('evolutions');
            evolutionsEl.innerHTML = '';
            pokemon.evolutions.forEach((evo, index) => {
                const span = document.createElement('span');
                span.textContent = evo;
                span.className = 'evolution-link';
                span.addEventListener('click', () => {
                    searchBar.value = evo;
                    displayPokemonInfo(evo.toLowerCase(), true); // Trigger evolving animation
                });
                evolutionsEl.appendChild(span);
                if (index < pokemon.evolutions.length - 1) {
                    evolutionsEl.appendChild(document.createTextNode(' → '));
                }
            });

            const movesList = document.getElementById('moves');
            movesList.innerHTML = '';
            pokemon.moves.forEach(move => {
                const li = document.createElement('li');
                li.textContent = `${move.name} (Power: ${move.power}, Accuracy: ${move.accuracy}%)`;
                movesList.appendChild(li);
            });

            // Draw sprite on canvas
            const canvas = document.getElementById('pokemon-canvas');
            drawPokemonSprite(canvas, pokemon.image, isEvolving);

            // Set dynamic background and table box colors
            const primaryType = pokemon.types[0];
            document.body.className = `type-${primaryType}`;
            document.querySelectorAll('.table-box').forEach(box => {
                box.style.backgroundColor = getComputedStyle(document.body).backgroundColor;
                box.style.opacity = '0.9';
            });

            // Update URL
            history.pushState({}, '', `?poke=${pokemonName.toLowerCase()}`);
        }

        // Handle search bar and suggestions
        const searchBar = document.getElementById('search-bar');
        const suggestionsDiv = document.getElementById('suggestions');

        searchBar.addEventListener('input', () => {
            const query = searchBar.value.toLowerCase();
            suggestionsDiv.innerHTML = '';
            if (query.length < 1) {
                suggestionsDiv.style.display = 'none';
                return;
            }

            const matches = allPokemonNames.filter(name => name.toLowerCase().includes(query)).slice(0, 10);
            matches.forEach(name => {
                const div = document.createElement('div');
                div.className = 'suggestion-item';
                div.textContent = name.charAt(0).toUpperCase() + name.slice(1);
                div.addEventListener('click', () => {
                    searchBar.value = div.textContent;
                    suggestionsDiv.style.display = 'none';
                    displayPokemonInfo(name);
                });
                suggestionsDiv.appendChild(div);
            });
            suggestionsDiv.style.display = matches.length > 0 ? 'block' : 'none';
        });

        // Hide suggestions when clicking outside
        document.addEventListener('click', (e) => {
            if (!searchBar.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                suggestionsDiv.style.display = 'none';
            }
        });

        // Handle Enter key to search
        searchBar.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && searchBar.value) {
                suggestionsDiv.style.display = 'none';
                displayPokemonInfo(searchBar.value);
            }
        });

        // Initialize
        async function init() {
            await fetchAllPokemonNames();
            const urlParams = new URLSearchParams(window.location.search);
            const pokemonName = urlParams.get('poke') || 'pikachu';
            searchBar.value = pokemonName.charAt(0).toUpperCase() + pokemonName.slice(1);
            displayPokemonInfo(pokemonName);
        }

        init();
    </script>
</body>
</html>
